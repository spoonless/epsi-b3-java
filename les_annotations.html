
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Les annotations &#8212; documentation Le langage Java 1.0</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Swing : les interfaces graphiques" href="swing_interfaces_graphiques.html" />
    <link rel="prev" title="Les classes internes" href="classe_interne.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="les-annotations">
<h1>Les annotations<a class="headerlink" href="#les-annotations" title="Lien permanent vers ce titre">¶</a></h1>
<p>Les annotations en Java sont des marqueurs qui permettent d’ajouter des
méta-données aux classes, aux méthodes, aux attributs, aux paramètres, aux
variables, aux paquets ou aux annotations elles-mêmes.</p>
<p>Les annotations sont utilisées dans des domaines divers. Leur intérêt principal
est de fournir une méta-information qui pourra être exploitée par un programme.</p>
<div class="section" id="utilisation-des-annotations">
<h2>Utilisation des annotations<a class="headerlink" href="#utilisation-des-annotations" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une annotation est un type (comme une classe ou une interface) du langage Java :
elle peut être référencée par son nom complet ou importée depuis un autre paquet
grâce au mot-clé <strong>import</strong>.</p>
<p>Une annotation n’est pas instanciée, elle est simplement accolée à l’élément
qu’elle vient enrichir :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Voiture</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;une voiture&quot;</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>L’annotation <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/Override.html">Override</a> est définie dans le package <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/package-summary.html">java.lang</a> (c’est pour cela
qu’il n’est pas nécessaire de l’importer explicitement). Cette annotation est
utilisable uniquement sur les méthodes pour indiquer que la méthode est une
surcharge d’une méthode d’une classe parente (dans l’exemple précédent, la méthode
surcharge <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#toString--">Object.toString</a>). Cette annotation est exploitée par le compilateur
pour réaliser des vérifications supplémentaires. C’est également le cas pour les
autres annotations déclarées dans le même package :</p>
<dl class="docutils">
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/Deprecated.html">Deprecated</a></dt>
<dd>Permet de générer des warnings afin d’informer les autres développeurs que
quelque chose (une classe, une méthode…) a été dépréciée et ne devrait plus
être utilisée.</dd>
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html">FunctionalInterface</a></dt>
<dd>Permet au compilateur de s’assurer que l’interface qui porte cette annotation
peut être implémentée par une lambda (Cf. <a class="reference internal" href="les_lambdas.html#functionalinterface"><span class="std std-ref">le chapitre sur les lambdas</span></a>).</dd>
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/Override.html">Override</a></dt>
<dd>Signale qu’une méthode est une surcharge d’une méthode déclarée dans une classe
parente. Cela permet au compilateur de signaler une erreur si ce n’est
pas le cas.</dd>
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/SuppressWarnings.html">SuppressWarnings</a></dt>
<dd>Permet de forcer le compilateur à ne plus émettre d’avertissement à la compilation
dans certains cas.</dd>
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/SafeVarargs.html">SafeVarargs</a></dt>
<dd>Cette annotation s’ajoute à une méthode acceptant un paramètre variable
(<em>varargs</em>) dont le type est un générique. En effet, le principe de l’effacement
de type (<em>type erasure</em>) dans la gestion des classes génériques fait qu’il
est possible de corrompre un type paramétré utilisé comme paramètre variable
sans que le compilateur et la JVM ne puissent le détecter. Pour pallier à ce problème,
le compilateur produit systématiquement un avertissement lorsqu’on utilise un
type générique comme paramètre variable. Cette annotation permet de supprimer
l’avertissement à la compilation et implique que le développeur s’est assuré
que son implémentation est sûre.</dd>
</dl>
<p>L’API standard de Java (mais également des bibliothèques tierces) fournissent
beaucoup d’autres annotations qui ne sont pas interprétées par le compilateur
mais par le programme lui-même à l’exécution.</p>
<p>Certaines annotations déclarent des attributs. Il est possible de spécifier
entre parenthèses la valeur de chaque attribut d’une annotation. Par exemple,
l’annotation <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/XmlRootElement.html">XmlRootElement</a> permet d’indiquer qu’une classe peut être instanciée
à partir d’un document XML et/ou qu’une de ses instances peut servir à générer
un document XML. Cette annotation accepte deux attributs optionnels : <em>name</em>
pour donner le nom de l’élément XML correspondant et <em>namespace</em> pour donner
l’espace de nom XML auquel l’élément appartient.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>

<span class="nd">@XmlRootElement</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;personne&quot;</span><span class="o">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">&quot;http://xml.personne.com/ns&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Personne</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">prenom</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">nom</span><span class="o">;</span>

  <span class="c1">// ...</span>

<span class="o">}</span>
</pre></div>
</div>
<p>Si un attribut est de type tableau alors, il est possible de passer plusieurs
valeurs entre accolades :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span> <span class="s">&quot;deprecation&quot;</span><span class="o">,</span> <span class="s">&quot;unused&quot;</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Mais si un attribut est de type tableau et que l’on veut fournir une seule
valeur alors, les accolades peuvent être omises :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;unused&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Enfin, si l’attribut porte le nom spécial <strong>value</strong> et qu’il est le seul dont
la valeur est donnée alors, il est possible d’omettre le nom :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;unused&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="declaration-d-une-annotation">
<h2>Déclaration d’une annotation<a class="headerlink" href="#declaration-d-une-annotation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Comme pour les classes, les interfaces et les énumérations, on crée une annotation
dans un fichier portant le même nom que l’annotation avec l’extension <em>.java</em>.
On déclare une annotation avec le mot-clé <strong>&#64;interface</strong>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3</span><span class="o">;</span>

<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">MyAnnotation</span> <span class="o">{</span>

<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Une annotation implémente implicitement l’interface <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Annotation.html">Annotation</a> et rien d’autre !</p>
</div>
<p>La déclaration des attributs d’une annotation a une syntaxe très particulière :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3</span><span class="o">;</span>

<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">MyAnnotation</span> <span class="o">{</span>
  <span class="n">String</span>  <span class="nf">name</span><span class="o">();</span>
  <span class="kt">boolean</span> <span class="nf">isOk</span><span class="o">();</span>
  <span class="kt">int</span><span class="o">[]</span>   <span class="nf">range</span><span class="o">()</span> <span class="k">default</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Les attributs d’une annotation peuvent être uniquement :</p>
<ul class="simple">
<li>un type primitif,</li>
<li>une chaîne de caractères (<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html">java.lang.String</a>),</li>
<li>une référence de classe (<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html">java.lang.Class</a>),</li>
<li>une Annotation (<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Annotation.html">java.lang.annotation.Annotation</a>),</li>
<li>une <a class="reference internal" href="enumeration.html"><span class="doc">énumération</span></a>,</li>
<li>un tableau à une dimension d’un de ces types.</li>
</ul>
<p>Le mot-clé <strong>default</strong> permet de spécifier une valeur d’attribut par défaut si
aucune valeur n’est donnée pour cet attribut lors de l’utilisation de cette annotation.</p>
<p>La déclaration d’une annotation peut elle-même être annotée par :</p>
<dl class="docutils">
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Documented.html">Documented</a></dt>
<dd>Pour indiquer si l’annotation doit apparaître dans la documentation générée
par un outil comme <em>javadoc</em>.</dd>
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Inherited.html">Inherited</a></dt>
<dd>Pour indiquer que l’annotation doit être héritée par la classe fille.</dd>
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html">Retention</a></dt>
<dd>Pour préciser le niveau de rétention de l’annotation (Cf. ci-dessous).</dd>
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Target.html">Target</a></dt>
<dd>Pour indiquer quels types d’éléments peuvent utiliser l’annotation : classe,
méthode, attribut…</dd>
<dt><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Repeatable.html">Repeatable</a></dt>
<dd>Pour indiquer qu’une annotation peut être déclarée plusieurs fois sur un même élément.</dd>
</dl>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.Documented</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.ElementType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Inherited</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.RetentionPolicy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="o">;</span>

<span class="nd">@Documented</span>
<span class="nd">@Target</span><span class="o">(</span><span class="n">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span>
<span class="nd">@Inherited</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">MyAnnotation</span> <span class="o">{</span>
  <span class="n">String</span>  <span class="nf">name</span><span class="o">();</span>
  <span class="kt">boolean</span> <span class="nf">isOk</span><span class="o">();</span>
  <span class="kt">int</span><span class="o">[]</span>   <span class="nf">range</span><span class="o">()</span> <span class="k">default</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>
<span class="o">}</span>
</pre></div>
</div>
<p>L’annotation ci-dessus porte des méta-annotations qui indiquent que l’utilisation
de cette annotation doit apparaître dans la documentation générée, qu’elle est
utilisable sur les types Java (c’est-à-dire les classes, les interfaces) et
que sa rétention est de type <em>RUNTIME</em>.</p>
</div>
<div class="section" id="retention-d-une-annotation">
<h2>Rétention d’une annotation<a class="headerlink" href="#retention-d-une-annotation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une annotation est définie par sa rétention, c’est-à-dire la façon dont une
annotation sera conservée. La rétention est définie grâce à la méta-annotation
<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html">Retention</a>. Les différentes rétentions d’annotation sont :</p>
<dl class="docutils">
<dt><strong>SOURCE</strong></dt>
<dd>L’annotation est accessible durant la compilation mais n’est pas intégrée dans
le fichier class généré.</dd>
<dt><strong>CLASS</strong></dt>
<dd>L’annotation est accessible durant la compilation, elle est intégrée dans le
fichier class généré mais elle n’est pas chargée dans la JVM à l’exécution.</dd>
<dt><strong>RUNTIME</strong></dt>
<dd>L’annotation est accessible durant la compilation, elle est intégrée dans le
fichier class généré et elle est chargée dans la JVM à l’exécution. Elle est
accessible par introspection.</dd>
</dl>
</div>
<div class="section" id="utilisation-des-annotations-par-introspection">
<h2>Utilisation des annotations par introspection<a class="headerlink" href="#utilisation-des-annotations-par-introspection" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une annotation ne produit aucun traitement. Cela signifie que si on utilise
des annotations dans son code, encore faut-il qu’un processus les interprète
pour produire le comportement attendu. Hormis les quelques annotations interprétées
par le compilateur, il faut donc s’assurer que les annotations seront traitées
correctement.</p>
<p>Pour des annotations de rétentions <strong>SOURCE</strong> et <strong>CLASS</strong>, leur interprétation
dépend de processeurs d’annotations qui sont des bibliothèques Java déclarées
en paramètre du compilateur ou de la JVM. Il s’agit d’une utilisation assez
avancée et relativement peu utilisée (en dehors des annotations directement
prises en charge par le compilateur lui-même).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://projectlombok.org/">Lombok</a> est un exemple de projet open-source fournissant des annotations
permettant de générer du code au moment de la compilation grâce à un
processeur d’annotations.</p>
</div>
<p>L’utilisation la plus courante (notamment avec Java EE) est l’utilisation
d’annotation de rétention <strong>RUNTIME</strong> car elles sont accessibles par introspection.</p>
<p>Java fournit une API standard appelée l’API de réflexion qui permet de réaliser
à l’exécution une introspection des objets et des classes. Cela signifie qu’il
est possible de connaître par programmation tout un ensemble de méta-informations.
Par exemple, on peut connaître la liste des méthodes d’une classe et pour chacune
le nombre et le type de ses paramètres. Mais surtout, on peut connaître les
annotations utilisées et la valeur de leurs attributs.</p>
<p>Imaginons que nous souhaitions créer une framework de tests automatisés. Nous
pouvons créer l’annotation <em>&#64;Test</em> qui servira à indiquer quelles méthodes
publiques d’une classe correspondent à des tests à exécuter par notre framework.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3.framework.test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.Documented</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.ElementType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Inherited</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.RetentionPolicy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="o">;</span>

<span class="nd">@Documented</span>
<span class="nd">@Inherited</span>
<span class="nd">@Target</span><span class="o">(</span><span class="n">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">Test</span> <span class="o">{</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Comme la rétention de cette annotation est <strong>RUNTIME</strong>, il est possible d’accéder
à cette annotation par introspection. Le framework de test peut contenir une
classe <em>TestFramework</em> qui accepte une instance de n’importe quel type d’objet
et qui va exécuter une à une les méthodes publiques ayant l’annotation <em>&#64;Test</em>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3.framework.test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestFramework</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Method</span><span class="o">[]</span> <span class="n">methods</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getMethods</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Method</span> <span class="n">method</span> <span class="o">:</span> <span class="n">methods</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">isAnnotationPresent</span><span class="o">(</span><span class="n">Test</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">runTest</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="n">method</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">runTest</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Test &quot;</span> <span class="o">+</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; ok&quot;</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InvocationTargetException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Test &quot;</span> <span class="o">+</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; ko&quot;</span><span class="o">);</span>
      <span class="n">e</span><span class="o">.</span><span class="na">getTargetException</span><span class="o">().</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Test &quot;</span> <span class="o">+</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; ko&quot;</span><span class="o">);</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Grâce à l’API de réflexion, il est possible d’accéder à la représentation objet
d’une classe avec la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#getClass--">getClass</a>.</p>
<p>Finalement, nous pouvons écrire une pseudo-classe de tests :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">fr.epsi.b3.framework.test.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fr.epsi.b3.framework.test.TestFramework</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MesTests</span> <span class="o">{</span>

  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doRight</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doWrong</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;simule un test en échec&quot;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">TestFramework</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">MesTests</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="exercice">
<h2>Exercice<a class="headerlink" href="#exercice" title="Lien permanent vers ce titre">¶</a></h2>
<div class="exercice topic">
<p class="topic-title first">Java et XML</p>
<p>Java propose une API nommée JAXB qui permet de transformer un document XML
en objets Java ou de transformer des objets Java en document XML. JAXB fournit
des annotations qui indiquent la correspondance en XML des classes et de leurs
attributs.</p>
<p>Parmi ces annotations, il y a :</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/XmlRootElement.html">XmlRootElement</a></li>
<li><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/XmlElement.html">XmlElement</a></li>
<li><a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/XmlAttribute.html">XmlAttribute</a></li>
</ul>
<p>Par ailleurs, JAXB permet de créer des instances de <em>Marshaller</em> et de <em>Unmarshaller</em>.
Le premier type permet de passer de Java à un document XML et le second type
réalise l’opération inverse.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Utilisation d’un Marshaller JAXB</span><a class="headerlink" href="#id2" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3.xml</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.bind.JAXBContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.Marshaller</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XmlMarshaller</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="n">JAXBContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Personne</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Adresse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">Marshaller</span> <span class="n">marshaller</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">createMarshaller</span><span class="o">();</span>
    <span class="n">marshaller</span><span class="o">.</span><span class="na">marshal</span><span class="o">(</span><span class="n">createPersonne</span><span class="o">(),</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;personne.xml&quot;</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Personne</span> <span class="nf">createPersonne</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// TODO à implémenter</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Utilisation d’un Unmarshaller JAXB</span><a class="headerlink" href="#id3" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">fr.epsi.b3.xml</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.bind.JAXBContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.Unmarshaller</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XmlUnmarshaller</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="n">JAXBContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Personne</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Adresse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">Unmarshaller</span> <span class="n">unmarshaller</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">createUnmarshaller</span><span class="o">();</span>
    <span class="n">Personne</span> <span class="n">personne</span> <span class="o">=</span> <span class="o">(</span><span class="n">Personne</span><span class="o">)</span> <span class="n">unmarshaller</span><span class="o">.</span><span class="na">unmarshal</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;personne.xml&quot;</span><span class="o">));</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">personne</span><span class="o">);</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<p>Étant donné le document XML suivant :</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;personne</span> <span class="na">id=</span><span class="s">&quot;0001&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;nom&gt;</span>Doe<span class="nt">&lt;/nom&gt;</span>
  <span class="nt">&lt;prenom&gt;</span>John<span class="nt">&lt;/prenom&gt;</span>
  <span class="nt">&lt;age&gt;</span>31<span class="nt">&lt;/age&gt;</span>
  <span class="nt">&lt;adresse</span> <span class="na">type=</span><span class="s">&quot;personnelle&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rue&gt;</span>9 allée des vignes<span class="nt">&lt;/rue&gt;</span>
    <span class="nt">&lt;codePostal&gt;</span>33000<span class="nt">&lt;/codePostal&gt;</span>
    <span class="nt">&lt;ville&gt;</span>Bordeaux<span class="nt">&lt;/ville&gt;</span>
  <span class="nt">&lt;/adresse&gt;</span>
<span class="nt">&lt;/personne&gt;</span>
</pre></div>
</div>
<p>Créez les classes <em>Personne</em> et <em>Adresse</em> et utilisez les annotations JAXB
de manière à pouvoir passer d’un représentation Java à une représentation XML
(et vice-versa).</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Le langage Java</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="compilation.html">Compilation &amp; exécution</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure_fondamentale.html">La structure fondamentale du langage</a></li>
<li class="toctree-l1"><a class="reference internal" href="premiere_classe.html">Une première classe</a></li>
<li class="toctree-l1"><a class="reference internal" href="types_primitifs.html">Les types primitifs</a></li>
<li class="toctree-l1"><a class="reference internal" href="operateurs.html">Les opérateurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="structures_de_controle.html">Les structures de contrôle</a></li>
<li class="toctree-l1"><a class="reference internal" href="tableau.html">Les tableaux</a></li>
<li class="toctree-l1"><a class="reference internal" href="attributs_et_methodes.html">Attributs &amp; méthodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="cycle_de_vie.html">Cycle de vie d’un objet</a></li>
<li class="toctree-l1"><a class="reference internal" href="package.html">Les packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="relations_entre_objets.html">Les relations entre objets</a></li>
<li class="toctree-l1"><a class="reference internal" href="polymorphisme.html">Le polymorphisme</a></li>
<li class="toctree-l1"><a class="reference internal" href="la_classe_object.html">La classe Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="la_classe_string.html">La classe String</a></li>
<li class="toctree-l1"><a class="reference internal" href="les_exceptions.html">Les exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="classe_abstraite.html">Les classes abstraites</a></li>
<li class="toctree-l1"><a class="reference internal" href="enumeration.html">Les énumérations</a></li>
<li class="toctree-l1"><a class="reference internal" href="les_dates.html">Les dates</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface.html">Les interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="generiques.html">Méthodes et classes génériques</a></li>
<li class="toctree-l1"><a class="reference internal" href="les_collections.html">Les collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="entrees_sorties.html">Les entrées/sorties</a></li>
<li class="toctree-l1"><a class="reference internal" href="les_lambdas.html">Les lambdas</a></li>
<li class="toctree-l1"><a class="reference internal" href="streams.html">Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="classe_interne.html">Les classes internes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Les annotations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#utilisation-des-annotations">Utilisation des annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#declaration-d-une-annotation">Déclaration d’une annotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#retention-d-une-annotation">Rétention d’une annotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#utilisation-des-annotations-par-introspection">Utilisation des annotations par introspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercice">Exercice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="swing_interfaces_graphiques.html">Swing : les interfaces graphiques</a></li>
<li class="toctree-l1"><a class="reference internal" href="swing_interactions.html">Swing : les interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="swing_notions_avancees.html">Swing : notions avancées</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://docs.oracle.com/javase/8/docs/">Documentation Java</a></li>
    
    <li class="toctree-l1"><a href="http://docs.oracle.com/javase/8/docs/api/index.html?overview-summary.html">API Java</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;
<a ref="author" href="mailto:david.gayerie.epsi@mailoo.org">David Gayerie</a>
<a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/fr/80x15.png" /></a>
.
      
    </div>

    

    
  </body>
</html>